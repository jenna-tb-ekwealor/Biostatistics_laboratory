<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Generalized Linear Models - Chapter 11</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: auto;
            max-width: 770px;
            line-height: 1.4;
            color: #000;
            padding: 20px 30px 30px 30px;
        }
        h1 {
            font-size: 38px;
            text-align: center;
            margin: 0;
            font-weight: normal;
        }
        h2 {
            font-size: 18px;
            color: #000;
            text-align: center;
            font-style: italic;
            font-weight: normal;
            margin-top: 0;
            margin-bottom: 40px;
        }
        h3 {
            font-size: 150%;
            color: #66023C;
            font-weight: 600;
            margin-top: 40px;
            margin-bottom: 10px;
        }
        h4 {
            margin-top: 30px;
        }
        hr {
            border: none;
            border-top: 1px solid #ddd;
            margin: 25px 0;
        }
        .investigation {
            background-color: rgba(214, 231, 251, 0.6);
            padding: 20px 22px;
            margin-bottom: 20px;
            border-radius: 6px;
        }
        pre {
            background-color: #F2F2F2;
            padding: 10px;
            border-radius: 5px;
            overflow-x: auto;
        }
        .questions, .challenge {
            margin: 15px 0;
        }
        .bonus {
            font-weight: bold;
        }
        .challenge-title {
            color: red;
            font-size: 150%;
            font-weight: 600;
        }
        .discussion-title {
            color: #2724ed;
            font-size: 150%;
            font-weight: 600;
        }
        .figure {
            margin: 25px 0;
            text-align: center;
        }
        .figure-caption {
            font-size: 0.9em;
            color: #555;
            margin-top: 5px;
        }
            div.creme {
            background-color: #fff5e6;
            border-radius: 5px;
            padding: 10px 20px;
            font-size: 80%;
        }
</style>
</head>
<body>

<h1>Generalized linear models</h1>
<h2>Chapter 12</h2>
<div style="margin-bottom: 20px;"></div>

<div class="investigation" style="text-align: justify; padding-top: 10px; padding-bottom: 10px;">
<p><strong>Today’s investigation.</strong> Small mammals like mice and squirrels play a central role in the ecology of many forests. As prey, seed dispersers, and disease hosts, they influence both ecosystem structure and public health. In particular, some rodents carry pathogens like <em>Borrelia burgdorferi</em>, the bacterium that causes Lyme disease. Infected ticks that bite these hosts can later transmit the disease to humans. Today, we will use a generalized linear model (GLM) to test how rodent diversity and ecological factors influence densities of infected ticks, which are vectors for Lyme disease, using data generated by the SFSU Swei Lab.</p>
</div>

<hr style="border-top: 1px solid #eee; margin: 5px 0 10px 0;">

<h3 style="margin-top: 20px;">Introduction</h3>
<p style="text-align: justify;">Habitat fragmentation alters the movement and composition of wildlife communities, with cascading effects on the distribution of parasites and the pathogens they carry. In the western United States, the black-legged tick <em>Ixodes pacificus</em> transmits several bacteria, including <em>Borrelia burgdorferi</em>, which causes Lyme disease. These ticks feed on a variety of hosts, including rodents, deer, and predators, and their infection rates are shaped by the diversity and abundance of those host species.</p>
<p style="text-align: justify;">Some pathogens, like <em>B. burgdorferi</em>, rely entirely on horizontal transmission-ticks must feed on an infected host to acquire and later transmit the bacteria. Others, like <em>Borrelia miyamotoi</em>, can be transmitted vertically from tick to offspring. Understanding how these ecological and evolutionary differences interact with landscape features and wildlife communities is key to predicting disease risk.</p>
<p style="text-align: justify;">In this lab, we will test whether the diversity of rodent hosts can help explain the density of <em>B. burgdorferi</em>-infected ticks across forest fragments in Northern California. This is the same question investigated by the Swei Lab at San Francisco State University, which investigates how landscape isolation and wildlife community metrics predict tick-borne pathogen distribution.</p>
<div class="figure" style="margin-top: 30px; margin-bottom: 30px;">
  <img src="images/cycle_I_pacificus.png" alt="Tick photo and life cycle diagram" style="max-width:85%; height:auto;">
  <div class="figure-caption">Figure 1. (A) Adult female western blacklegged tick, <em>Ixodes pacificus</em>. CDC/Loftis et al. (B) Tick transmission cycle. Barbour & Zückert, <em>Nature</em> 390:553–554 (1997).</div>
</div>

<p><strong>Upon completion of this lab, you should be able to:</strong></p>
<ol type="a">
<li>Fit GLMs using R.</li>
<li>Interpret GLM outputs, including coefficients and AIC values.</li>
<li>Compare GLMs to models introduced in previous labs.</li>
<li>Fit GLMMs with random effects using <code>glmmTMB()</code>.</em></li>
</ol>

<p style="font-size: 95%; font-weight: bold; margin-top: 40px; margin-bottom: 10px;">References:</p>
<ul>
  <li><a href="https://doi.org/10.1098/rsos.240837" target="_blank">Shaw et al. 2024</a></li>
</ul>
<hr>
<h3>Worked example</h3>
<p style="text-align: justify;">Suppose you are studying how the number of bird visits to a feeder changes with outdoor temperature. You observe a series of 10-minute intervals and count how many birds visit a feeder at different temperatures throughout the day. The response variable is a <strong>count</strong> ;  discrete, non-negative, and often right-skewed. Because of this, a linear model (which assumes normally distributed residuals and constant variance) would not be appropriate. Instead, we use a <strong>generalized linear model</strong> (GLM) with a Poisson distribution, which is designed for modeling count data.</p>

<p style="text-align: justify;">GLMs can be written in the form:</p>
<p style="text-align: center;"><em>g(&mu;) = &beta;<sub>0</sub> + &beta;<sub>1</sub>X</em></p>
<p style="text-align: justify;">where <em>g()</em> is the <strong>link function</strong>. For Poisson models, this is the log function. This equation says that the log of the expected count (bird visits) is a linear function of the predictor (temperature).</p>

<pre style="background-color: #f8f8f8; border: 1px solid #ccc; padding: 10px;"><code><span style="color:#6a737d; font-style: italic;"># Fit a Poisson GLM</span>
glm(bird_visits ~ temperature, family = "poisson", data = birds)</code></pre>

<div class="figure" style="margin-top: 30px; margin-bottom: 30px;">
  <img src="images/poisson_glm_bird_visits.png" alt="Poisson GLM bird visits" style="max-width:100%; height:auto;">
  <div class="figure-caption">Figure 3. Hypothetical Poisson GLM showing bird visits as a function of temperature. The red line is the expected count under a Poisson model.</div>
</div>

<p style="text-align: justify;">This plot helps illustrate two things. First, count data are right-skewed and discrete. Second, the relationship between temperature and bird visits is curved on the original scale, but linear when viewed on the log scale; exactly what the Poisson GLM models.</p>

<p style="text-align: justify;">To decide which predictors to include, we can compare models using the <strong>Akaike Information Criterion (AIC)</strong>. AIC rewards models that fit the data well but penalizes complexity. The model with the lowest AIC is considered the best among those being compared.</p>

<p style="text-align: justify;">What if the bird visits were measured at multiple times of day in the same location, and we suspected the counts might be correlated by location? In that case, we could use a <strong>generalized linear mixed model (GLMM)</strong>, which allows us to include <em>random effects</em> such as Site or observer. GLMMs are extensions of GLMs that account for grouping or repeated measures in the data.</p>

<div class="questions" style="margin-top: 30px;">
</div>
</div>

</div>

<p><span style="color:#66023C; font-size:100%; font-weight:600"> <strong>Stop, Think:</strong> </span> Interpret the model output from R (GLM table). <strong>Stop</strong> and review the Worked example. <strong>Think</strong> about how you can obtain each value in the model output.</p>
</div>

<br>

<p style="text-align: justify;">GLMs are most often used when you want to model a response variable that is not continuous and normally distributed. But how do we know if one GLM is better than another? One common method is to use the <strong>Akaike Information Criterion (AIC)</strong>, which balances model fit and complexity. A model with a lower AIC is considered better; it explains more of the variation in the data with fewer or more efficient predictors.</p>

<p style="text-align: justify;">Finally, what if we suspect that observations are grouped, and that there's unmeasured variation across those groups? This is where <strong>generalized linear mixed models (GLMMs)</strong> come in. GLMMs allow us to include <em>random effects</em>, such as variation by site or subject, which helps us avoid biased estimates. These models are especially useful for repeated measures or nested data; like multiple tick samples taken from the same location.</p>


<hr> 


<h3>Materials and Methods</h3>
<ul>
  <li>R and RStudio</li>
  <li>package <code>ggplot2</code></li>
  <li>package <code>glmmTMB</code></li>
  <li>tick.csv</li>
</ul>
<p style="text-align: justify;"><strong>Variable descriptions:</strong> In this lab, we focus on three variables from the dataset. <code>DIN_Bbsl</code> refers to the density of infected nymphs (ticks) carrying <em>Borrelia burgdorferi sensu lato</em>. <code>Rodent_Rich</code> is the number of different rodent species observed at a site. <code>Predator_Shannon_wCat</code> is the Shannon diversity index of predator species (including cats), and <code>Site</code> identifies each sampled location.</p>

<br> 
  
<p style="text-align: justify;">Today’s activity on <em>rodent diversity and infected tick density</em> is organized into one main exercise that explores how rodent communities influence tick-borne pathogen dynamics. This exercise will help us apply GLMs to real ecological data, interpret R model outputs, and check model assumptions.</p>

<p style="margin-top: 40px; margin-bottom: 20px;"><span style="color:darkblue; font-size:190%; font-weight:500">Rodent diversity and infected tick density</span></p>

<p style="margin-bottom: 25px;"><div style="margin-bottom: 25px;"><p><strong>Research question 1:</strong> Does rodent richness predict the density of <em>Borrelia</em>-infected ticks?</p></div>

<p style="text-align: justify;">Before we begin fitting models, let’s load the dataset. It contains site-level summaries of tick density, rodent richness, predator diversity, and other ecological variables collected from forest fragments across Northern California.</p>
<p style="margin-top: 30px;"><strong>1. Import the data</strong> Let’s import the <code>"tick.csv"</code> dataset and explore it.</p>


<div class="questions" style="margin-top: 30px;">
<p><strong>Questions:</strong></p>
<ol type="a">
    <li><em>How many observations and variables?</em></li>
    <li><em>What type of variable is the response (DIN_Bbsl)?</em></li>
</ol>
</div>

<br> 

<h4 style="margin-top: 35px;">2. Fit a Poisson GLM</h4>
<p style="text-align: justify;">We are using a Poisson model here because our response variable(tick infection density)is a count. Poisson models are designed for count data that are non-negative integers and often right-skewed. In Poisson GLMs, the variance increases with the mean, which often fits ecological count data better than assuming constant variance and normality.</p>
<pre style="background-color: #f8f8f8; border: 1px solid #ccc; padding: 10px;"><code><span style="color:#6a737d; font-style: italic;"># Fit GLM with Poisson family</span>
<span style="color:#000000;">tick_glm &lt;- glm(DIN_Bbsl ~ Rodent_Rich, family = &quot;poisson&quot;, data = tick)</span>
summary(tick_glm)</code></pre>
<br>

<div class="questions" style="margin-top: 30px;">
<p><span style="color:#66023C; font-size:100%; font-weight:600"> <strong>Stop, Think:</strong> </span> <strong>Stop</strong> and consider: <em>What is the coefficient for rodent richness, and what does it mean?</em> <strong>Think</strong> about: <em>Is it statistically significant?</em></p>
</div>
<br>
</ul>
</div>

<div class="creme">
<p><span style="color:blue; font-size:120%; font-weight:600"> <strong>Info-Box!</strong> </span> Let’s interpret R’s <strong>glm()</strong> summary output.</p>
<pre style="background-color: #f8f8f8; border: 1px solid #ccc; padding: 10px;"><code><span style="color:#6a737d; font-style: italic;"># GLM output</span>
summary(tick_glm)</code></pre>
<p style="text-align: justify;"><strong>Estimate:</strong> These are the model coefficients. The intercept gives the expected log count of ticks when rodent richness is zero. The coefficient for <code>rodent_richness</code> tells us how much the log of the expected count changes with each additional rodent species.</p>
<p style="text-align: justify;"><strong>Std. Error:</strong> This tells us how much uncertainty there is in the coefficient estimate. A large value here suggests the model is less confident in the estimate.</p>
<p style="text-align: justify;"><strong>z value:</strong> This is the test statistic used to evaluate whether the coefficient is different from zero. It's like a t-value in linear models.</p>
<p style="text-align: justify;"><strong>Pr(&gt;|z|):</strong> This is the p-value. If it's less than 0.05, we usually consider the effect statistically significant.</p>
<p style="text-align: justify;">Together, these values help us interpret the model and assess which predictors are meaningful.</p>
</div>

<br>

<h4>3. Plot your GLM predictions</h4>
<p style="text-align: justify;">After fitting a GLM, it’s useful to visualize the model predictions alongside your raw data. To do this, we can use the <code>predict()</code> function, which takes a fitted model and returns predicted values. These predictions can then be added as a new column in our dataset and plotted against the observed data to assess model fit and shape.</p>
<pre style="background-color: #f8f8f8; border: 1px solid #ccc; padding: 10px;"><code><span style="color:#6a737d; font-style: italic;"># Add model predictions to the dataset</span>
tick$predicted &lt;- predict(tick_glm, type = "response")

<span style="color:#6a737d; font-style: italic;"># Plot observed and predicted values</span>
ggplot(tick, aes(x = Rodent_Rich, y = DIN_Bbsl)) +
  geom_point(alpha = 0.6) +
  geom_line(aes(y = predicted), color = "red", size = 1) +
  labs(
    x = "Rodent richness",
    y = "Density of infected nymphs (DIN_Bbsl)",
    title = "Predicted vs. Observed: GLM for Infected Tick Density") +
  theme_minimal()</code></pre>
  
<br>

<div class="challenge" style="margin-top: 30px;">
<span class="challenge-title">Challenge.</span> Can you add something from your model output to this plot? Try using <code>annotate()</code> or <code>geom_text()</code> to display the model’s AIC or coefficient for rodent richness somewhere on the plot.
</div>

<br>

<h4 style="margin-top: 35px;">4. Plot model diagnostics</h4>
<p style="text-align: justify;">After fitting a model, it’s important to assess how well it fits the data. In this step, we’ll visualize the residuals and fitted values to check for overdispersion and other patterns that might indicate poor model fit.</p>
<pre style="background-color: #f8f8f8; border: 1px solid #ccc; padding: 10px;"><code><span style="color:#6a737d; font-style: italic;"># Diagnostic plots for GLM</span>
plot(tick_glm)</code></pre>

<p style="text-align: justify;"></p>

<div class="questions" style="margin-top: 30px;">
<p><strong>Questions:</strong></p>
<ol type="a">
<li><em>What do you see in your plots? Can you spot any trends, outliers, or points that stand out?</em></li>
</ol>
</ul>
</div>

<br>

<div class="creme">
<p><span style="color:blue; font-size:120%; font-weight:600"> <strong>Info-Box!</strong> </span> The four diagnostic plots from <code>plot()</code> can help you check how well your GLM fits the data. Each one gives you different clues about how your model behaves.</p>
<ul>
  <li><strong>Residuals vs. Fitted:</strong> Look for patterns, curves, or spreading as values increase.</li>
  <li><strong>Normal Q-Q:</strong> Compare observed residuals to a normal distribution. Watch for points that stray from the line.</li>
  <li><strong>Scale-Location:</strong> Shows whether variability changes as fitted values increase.</li>
  <li><strong>Residuals vs. Leverage:</strong> Highlights data points that might be unusually influential on the model.</li>
</ul>
</div>

<br>

<h4>5. Add another predictor</h4>
<p style="text-align: justify;">In Chapter 10, we explored how using two explanatory variables together can help reveal interactions or explain more variation in a response. Here, we’ll test whether adding another biologically relevant predictor - predator diversity — improves our model of tick infection density. This step mirrors the idea of exploring multiple factors at once, just as we did with two-way ANOVA.</p>
<div class="questions" style="margin-top: 30px;">
<p><span style="color:#66023C; font-size:100%; font-weight:600"> <strong>Stop, Think:</strong> </span> <strong>Stop</strong> and consider the original research question and study design. <strong>Think</strong> about what other biological factors could influence tick infection density, and whether interactions among variables, like those you explored in two-way ANOVA, might reveal new insights.</p>
</div>
<pre style="background-color: #f8f8f8; border: 1px solid #ccc; padding: 10px;"><code><span style="color:#6a737d; font-style: italic;"># Compare two GLMs with AIC</span>
tick_glm2 &lt;- glm(DIN_Bbsl ~ Rodent_Rich + Predator_Shannon_wCat, family = \"poisson\", data = tick)
AIC(tick_glm, tick_glm2)</code></pre>
  

<div class="questions" style="margin-top: 30px;">
<p><strong>Questions:</strong></p>
<ol type="a">
<li><em>Which model has the lower AIC?</em></li>
<li><em>Does predator diversity add meaningful information?</em></li>
</ol>
</ul>
</div>

<br>


<div class="challenge" style="margin-top: 30px;">
<span class="challenge-title">Challenge.</span> What if some unmeasured differences among sampling locations are influencing your results? Can you extend your GLM to account for grouping in your data? <strong>Hint:</strong> Look for a variable that identifies the locations where data were collected.
</div>

<br> 
  
<div class="questions" style="margin-top: 30px;">
<p><span class="discussion-title">Discussion questions</span></p>
<ol type="a">
<li><em>What makes a GLM different from a linear model?</em></li>
<li><em>Why does a Poisson GLM use a log link function?</em></li>
<li><em>What does AIC tell us when comparing two GLMs?</em></li>
</ol>
</div>

<p style="text-align: center; font-size: 16px; font-weight: bold; color: #000; margin-top: 40px; margin-bottom: 50px;">Great Work!</p>


<hr>



</body>
</html>
