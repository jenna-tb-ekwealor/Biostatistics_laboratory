<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Generalized Linear Models - Chapter 11</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: auto;
            max-width: 770px;
            line-height: 1.4;
            color: #000;
            padding: 20px 30px 30px 30px;
        }
        h1 {
            font-size: 38px;
            text-align: center;
            margin: 0;
            font-weight: normal;
        }
        h2 {
            font-size: 18px;
            color: #000;
            text-align: center;
            font-style: italic;
            font-weight: normal;
            margin-top: 0;
            margin-bottom: 40px;
        }
        h3 {
            font-size: 150%;
            color: #66023C;
            font-weight: 600;
            margin-top: 40px;
            margin-bottom: 10px;
        }
        h4 {
            margin-top: 30px;
        }
        hr {
            border: none;
            border-top: 1px solid #ddd;
            margin: 25px 0;
        }
        .investigation {
            background-color: rgba(214, 231, 251, 0.6);
            padding: 20px 22px;
            margin-bottom: 20px;
            border-radius: 6px;
        }
        pre {
            background-color: #F2F2F2;
            padding: 10px;
            border-radius: 5px;
            overflow-x: auto;
        }
        .questions, .challenge {
            margin: 15px 0;
        }
        .bonus {
            font-weight: bold;
        }
        .challenge-title {
            color: red;
            font-size: 150%;
            font-weight: 600;
        }
        .discussion-title {
            color: #2724ed;
            font-size: 150%;
            font-weight: 600;
        }
        .figure {
            margin: 25px 0;
            text-align: center;
        }
        .figure-caption {
            font-size: 0.9em;
            color: #555;
            margin-top: 5px;
        }
            div.creme {
            background-color: #fff5e6;
            border-radius: 5px;
            padding: 20px;
            font-size: 80%;
        }
</style>
</head>
<body>

<h1>Generalized linear models</h1>
<h2>Chapter 11</h2>
<br>

<div class="investigation" style="text-align: justify; padding-top: 10px; padding-bottom: 10px;">
<p><strong>Today’s investigation.</strong> Small mammals like mice and squirrels play a central role in the ecology of many forests. As prey, seed dispersers, and disease hosts, they influence both ecosystem structure and public health. In particular, some rodents carry pathogens like <em>Borrelia burgdorferi</em>, the bacterium that causes Lyme disease. Infected ticks that bite these hosts can later transmit the disease to humans. Today, we will use a generalized linear model (GLM) to test how rodent diversity and ecological factors influence densities of infected ticks, which are vectors for Lyme disease, using data generated by the SFSU Swei Lab.</p>
</div>

<hr style="border-top: 1px solid #eee; margin: 5px 0 10px 0;">

<h3 style="margin-top: 20px;">Introduction</h3>
<p style="text-align: justify;">Habitat fragmentation alters the movement and composition of wildlife communities, with cascading effects on the distribution of parasites and the pathogens they carry. In the western United States, the black-legged tick <em>Ixodes pacificus</em> transmits several bacteria, including <em>Borrelia burgdorferi</em>, which causes Lyme disease. These ticks feed on a variety of hosts, including rodents, deer, and predators, and their infection rates are shaped by the diversity and abundance of those host species.</p>
<p style="text-align: justify;">Some pathogens, like <em>B. burgdorferi</em>, rely entirely on horizontal transmission-ticks must feed on an infected host to acquire and later transmit the bacteria. Others, like <em>Borrelia miyamotoi</em>, can be transmitted vertically from tick to offspring. Understanding how these ecological and evolutionary differences interact with landscape features and wildlife communities is key to predicting disease risk.</p>
<p style="text-align: justify;">In this lab, we will test whether the diversity of rodent hosts can help explain the density of <em>B. burgdorferi</em>-infected ticks across forest fragments in Northern California. This question is motivated by research conducted by the Swei Lab at San Francisco State University, which investigated how landscape isolation and wildlife community metrics predict tick-borne pathogen distribution.</p>
<div class="figure" style="margin-top: 30px; margin-bottom: 30px;">
    <em>[Insert placeholder figure: tick-host-pathogen interaction diagram]</em>
    <div class="figure-caption">Figure 2. Conceptual diagram of rodent hosts and landscape features influencing infected tick densities.</div>
</div>

<p><strong>Upon completion of this lab, you should be able to:</strong></p>
<ol type="a">
<li>Fit GLMs using R.</li>
<li>Interpret GLM outputs, including coefficients and AIC values.</li>
<li>Compare GLMs to models introduced in previous labs.</li>
<li>Fit GLMMs with random effects using <code>glmmTMB()</code>.</em></li>
</ol>

<p style="font-size: 95%; font-weight: bold; margin-top: 40px; margin-bottom: 10px;">References:</p>
<ul>
  <li><a href="https://doi.org/10.1098/rsos.240837" target="_blank">Shaw et al. 2024</a></li>
</ul>
<hr>

<h3>Materials and Methods</h3>
<ul>
  <li>R and RStudio</li>
  <li>package <code>ggplot2</code></li>
  <li>Full_summary.csv</li>
</ul>

<p>Let’s say you are studying how the number of pollinator visits depends on flower color. You count the number of visits to red, yellow, and white flowers over a 10-minute period. This is count data, and the response is not normally distributed. So we fit a GLM with a Poisson distribution:</p>

<pre style="background-color: #f8f8f8; border: 1px solid #ccc; padding: 10px;"><code><span style="color:#6a737d; font-style: italic;"># Fit GLM to flower color count data</span>
glm(visits ~ color, family = "poisson", data = flowers)</span></code></pre>

<p>GLMs take the form:</p>
<p><em>g(µ) = β₀ + β₁X₁ + … + βₙXₙ</em>, where <em>g()</em> is the link function (e.g., log for Poisson).</p>

<p>If your response is a binary outcome (infected vs not), you could use a binomial GLM with a logit link.</p>

<div class="questions" style="margin-top: 30px;">
<p><span style="color:#66023C; font-size:100%; font-weight:600"> <strong>Stop, Think:</strong> </span> Interpret the model output from R (GLM table). <strong>Stop</strong> and review the Worked example. <strong>Think</strong> about how you can obtain each value in the model output.</p>
</div>

<p style="text-align: justify;">Today’s activity on <em>rodent diversity and infected tick density</em> is organized into one main exercise that explores how rodent communities influence tick-borne pathogen dynamics. This exercise will help us apply GLMs to real ecological data, interpret R model outputs, and check model assumptions.</p>

<p style="margin-top: 40px; margin-bottom: 20px;"><span style="color:darkblue; font-size:190%; font-weight:500">Rodent diversity and infected tick density</span></p>

<p style="margin-bottom: 25px;"><div style="margin-bottom: 25px;"><p><strong>Research question 1:</strong> Does rodent richness predict the density of <em>Borrelia</em>-infected ticks?</p></div>

<p style="margin-top: 30px;"><p><strong>1. Import the data</strong> Let’s import the <code>"Full_summary.csv"</code> dataset and explore it.</p>


<div class="questions" style="margin-top: 30px;">
<p><strong>Questions:</strong></p>
<ol type="a">
    <li><em>How many observations and variables?</em></li>
    <li><em>What type of variable is the response (DIN_Bbsl)?</em></li>
</ul>
</div>

<h4 style="margin-top: 35px;">2. Fit a Poisson GLM</h4>
<pre style="background-color: #f8f8f8; border: 1px solid #ccc; padding: 10px;"><code><span style="color:#6a737d; font-style: italic;"># Fit GLM with Poisson family</span>
<span style="color:#000000;">tick_glm &lt;- glm(DIN_Bbsl ~ rodent_richness, family = &quot;poisson&quot;, data = summary)</span>
summary(tick_glm)</code></pre>
<br>

<div class="questions" style="margin-top: 30px;">
<p><span style="color:#66023C; font-size:100%; font-weight:600"> <strong>Stop, Think:</strong> </span> <strong>Stop</strong> and consider: <em>What does the coefficient for rodent richness mean?</em> <strong>Think</strong> about: <em>Is it statistically significant?</em></p>
</div>
<br>
</ul>
</div>

<div class="creme">
<p><span style="color:blue; font-size:120%; font-weight:600"> <strong>Info-Box!</strong> </span> Let’s interpret R’s <strong>glm()</strong> summary output.</p>
<pre style="background-color: #f8f8f8; border: 1px solid #ccc; padding: 10px;"><code><span style="color:#6a737d; font-style: italic;"># GLM output</span>
summary(tick_glm)</code></pre>
<p style="text-align: justify;"><strong>Estimate:</strong> These are the model coefficients. The intercept gives the expected log count of ticks when rodent richness is zero. The coefficient for <code>rodent_richness</code> tells us how much the log of the expected count changes with each additional rodent species.</p>
<p style="text-align: justify;"><strong>Std. Error:</strong> This tells us how much uncertainty there is in the coefficient estimate. A large value here suggests the model is less confident in the estimate.</p>
<p style="text-align: justify;"><strong>z value:</strong> This is the test statistic used to evaluate whether the coefficient is different from zero. It's like a t-value in linear models.</p>
<p style="text-align: justify;"><strong>Pr(&gt;|z|):</strong> This is the p-value. If it's less than 0.05, we usually consider the effect statistically significant.</p>
<p style="text-align: justify;">Together, these values help us interpret the model and assess which predictors are meaningful.</p>
</div>

<br>
<h4 style="margin-top: 35px;">4. Plot model diagnostics</h4>
<pre style="background-color: #f8f8f8; border: 1px solid #ccc; padding: 10px;"><code><span style="color:#6a737d; font-style: italic;"># Diagnostic plots for GLM</span>
plot(tick_glm)</code></pre>
<pre style="background-color: #f8f8f8; border: 1px solid #ccc; padding: 10px;"><code><span style="color:#6a737d; font-style: italic;"># Diagnostic plots for GLM</span>
plot(tick_glm)</code></pre>






<h4>5. Add another predictor</h4>
<pre style="background-color: #f8f8f8; border: 1px solid #ccc; padding: 10px;"><code><span style="color:#6a737d; font-style: italic;"># Compare two GLMs with AIC</span>
tick_glm2 &lt;- glm(DIN_Bbsl ~ rodent_richness + predator_shannon, family = "poisson", data = summary)
AIC(tick_glm, tick_glm2)</code></pre>
  

<div class="questions" style="margin-top: 30px;">
<p><strong>Questions:</strong></p>
<ol type="a">
<li><em>Which model has the lower AIC?</em></li>
<li><em>Does predator diversity add meaningful information?</em></li>
</ol>
</ul>
</div>
  

<h4>6. Try a mixed-effects GLM</h4>
<pre style="background-color: #f8f8f8; border: 1px solid #ccc; padding: 10px;"><code><span style="color:#6a737d; font-style: italic;"># Fit a mixed-effects model</span>
library(glmmTMB)
tick_glmm &lt;- glmmTMB(DIN_Bbsl ~ rodent_richness + (1 | site), family = "nbinom2", data = summary)
summary(tick_glmm)</code></pre>


<div class="challenge" style="margin-top: 30px;">
<span class="challenge-title">Challenge.</span> Check the model assumptions of your GLM. <strong>Hint</strong>: residuals in GLMs are not always normally distributed like in linear models, but we still want to check for patterns that suggest poor fit or overdispersion. Try plotting residuals vs. fitted values, looking at Q-Q plots, and checking whether variance increases with fitted values. What do you notice?
</div>

  
<div class="questions" style="margin-top: 30px;">
<p><span class="discussion-title">Discussion questions</span></p>
<ol type="a">
<li><em>How do random effects improve this model?</em></li>
<li><em>Why did we switch from Poisson to negative binomial?</em></li>
</ol>
</div>

<p style="text-align: center; font-size: 16px; font-weight: bold; color: #000; margin-top: 40px; margin-bottom: 50px;">Great Work!</p>


<hr>



</body>
</html>
